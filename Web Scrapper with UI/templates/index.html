<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Crawler</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-400 p-4">
    <div class="max-w-lg mx-auto bg-white p-8 rounded shadow">
        <h1 class="text-xl font-bold mb-4">Web Crawler</h1>
        <form id="crawler-form">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="url">
                    URL to crawl
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="url" type="text" placeholder="Enter URL">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="max-pages">
                    Maximum number of pages to crawl
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="max-pages" type="number" placeholder="Enter maximum pages">
            </div>
            <button id="start-crawling" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">
                Start Crawling
            </button>
        </form>
        <div id="progress" class="mt-4">
            <h2 id="status" class="text-lg font-bold mb-2">Crawling in progress...</h2>
            <div id="crawled-data">Crawled Data</div>
            <div id="malicious-links" class="mt-4"></div>
        </div>
    </div>
    
    <script>
        document.getElementById('start-crawling').addEventListener('click', async () => {
            document.getElementById('progress').classList.remove('hidden');
            document.getElementById('crawled-data').innerHTML = "";
            document.getElementById('malicious-links').innerHTML = "";
            
            const url = document.getElementById('url').value;
            const maxPages = document.getElementById('max-pages').value;

            const eventSource = new EventSource(`/crawl?url=${url}&max_pages=${maxPages}`);
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                if (data.crawled_pages !== undefined) {
                    document.getElementById('status').innerText = `Crawled ${data.crawled_pages} pages`;
                } else if (data.status !== undefined) {
                    document.getElementById('status').innerText = data.status;
                } else if (data.page !== undefined) {
                    const pageContainer = document.createElement('div');
                    pageContainer.classList.add('border', 'rounded', 'p-4', 'mb-4');

                    const urlHeading = document.createElement('h2');
                    urlHeading.classList.add('text-lg', 'font-bold', 'mb-2');
                    urlHeading.innerText = `URL: ${data.page.url}`;
                    pageContainer.appendChild(urlHeading);

                    const images = document.createElement('div');
                    images.classList.add('mb-2');
                    images.innerHTML = '<strong>Images:</strong><ul>';
                    data.page.images.forEach(image => {
                        images.innerHTML += `<li>${image}</li>`;
                    });
                    images.innerHTML += '</ul>';
                    pageContainer.appendChild(images);

                    const paragraphs = document.createElement('div');
                    paragraphs.classList.add('mb-2');
                    paragraphs.innerHTML = '<strong>Paragraphs:</strong><ul>';
                    data.page.paragraphs.forEach(paragraph => {
                        paragraphs.innerHTML += `<li>${paragraph}</li>`;
                    });
                    paragraphs.innerHTML += '</ul>';
                    pageContainer.appendChild(paragraphs);

                    const tables = document.createElement('div');
                    tables.classList.add('mb-2');
                    tables.innerHTML = '<strong>Tables:</strong>';
                    data.page.tables.forEach(table => {
                        tables.innerHTML += '<table class="border-collapse border">';
                        table.forEach(row => {
                            tables.innerHTML += '<tr>';
                            row.forEach(cell => {
                                tables.innerHTML += `<td class="border p-2">${cell}</td>`;
                            });
                            tables.innerHTML += '</tr>';
                        });
                        tables.innerHTML += '</table>';
                    });
                    pageContainer.appendChild(tables);

                    const lists = document.createElement('div');
                    lists.classList.add('mb-2');
                    lists.innerHTML = '<strong>Lists:</strong>';
                    data.page.lists.forEach(list => {
                        lists.innerHTML += '<ul>';
                        list.forEach(item => {
                            lists.innerHTML += `<li>${item}</li>`;
                        });
                        lists.innerHTML += '</ul>';
                    });
                    pageContainer.appendChild(lists);

                    const forms = document.createElement('div');
                    forms.classList.add('mb-2');
                    forms.innerHTML = '<strong>Forms:</strong>';
                    data.page.forms.forEach(form => {
                        forms.innerHTML += `<div><strong>Action:</strong> ${form.action}</div>`;
                        forms.innerHTML += `<div><strong>Method:</strong> ${form.method}</div>`;
                        forms.innerHTML += '<div><strong>Inputs:</strong><ul>';
                        form.inputs.forEach(input => {
                            for (const key in input) {
                                forms.innerHTML += `<li>${key}: ${input[key]}</li>`;
                            }
                        });
                        forms.innerHTML += '</ul></div>';
                    });
                    pageContainer.appendChild(forms);

                    const options = document.createElement('div');
                    options.classList.add('mb-2');
                    options.innerHTML = '<strong>Select Options:</strong>';
                    data.page.options.forEach(select => {
                        options.innerHTML += `<div><strong>Name:</strong> ${select.name}</div>`;
                        options.innerHTML += '<div><strong>Options:</strong><ul>';
                        select.options.forEach(option => {
                            options.innerHTML += `<li>${option}</li>`;
                        });
                        options.innerHTML += '</ul></div>';
                    });
                    pageContainer.appendChild(options);

                    const buttons = document.createElement('div');
                    buttons.classList.add('mb-2');
                    buttons.innerHTML = '<strong>Buttons:</strong><ul>';
                    data.page.buttons.forEach(button => {
                        buttons.innerHTML += `<li>${button}</li>`;
                    });
                    buttons.innerHTML += '</ul>';
                    pageContainer.appendChild(buttons);

                    const labels = document.createElement('div');
                    labels.classList.add('mb-2');
                    labels.innerHTML = '<strong>Labels:</strong><ul>';
                    data.page.labels.forEach(label => {
                        labels.innerHTML += `<li>${label}</li>`;
                    });
                    labels.innerHTML += '</ul>';
                    pageContainer.appendChild(labels);

                    const headings = document.createElement('div');
                    headings.classList.add('mb-2');
                    headings.innerHTML = '<strong>Headings:</strong>';
                    for (let i = 1; i <= 6; i++) {
                        if (data.page.headings[`h${i}`] && data.page.headings[`h${i}`].length > 0) {
                            headings.innerHTML += `<h${i}>`;
                            data.page.headings[`h${i}`].forEach(heading => {
                                headings.innerHTML += `${heading}<br>`;
                            });
                            headings.innerHTML += `</h${i}>`;
                        }
                    }
                    pageContainer.appendChild(headings);

                    const metaTags = document.createElement('div');
                    metaTags.classList.add('mb-2');
                    metaTags.innerHTML = '<strong>Meta Tags:</strong><ul>';
                    data.page.meta_tags.forEach(tag => {
                        metaTags.innerHTML += `<li>${tag}</li>`;
                    });
                    metaTags.innerHTML += '</ul>';
                    pageContainer.appendChild(metaTags);

                    const links = document.createElement('div');
                    links.classList.add('mb-2');
                    links.innerHTML = '<strong>Links:</strong><ul>';
                    data.page.links.forEach(link => {
                        links.innerHTML += `<li><a href="${link}" target="_blank">${link}</a></li>`;
                    });
                    links.innerHTML += '</ul>';
                    pageContainer.appendChild(links);

                    document.getElementById('crawled-data').appendChild(pageContainer);
                }
            };
            
            eventSource.onerror = function(event) {
                console.error('EventSource failed:', event);
                eventSource.close();
                document.getElementById('status').innerText = 'Crawling failed!';
            };
        });
    </script>
</body>
</html>
